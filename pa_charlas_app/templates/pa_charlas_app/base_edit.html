{% extends 'pa_charlas_app/base.html' %}

{% load bootstrap4 %}

{% block content %}
	<h2>{{ titulo }}</h2>
	<form method="POST">{% csrf_token %}
		<input type="hidden" name="url_donde_volver" value="{{ url_donde_volver }}">
		<input type="hidden" name="extra_form_data" value="{{ extra_form_data }}">
		{% bootstrap_form form %}

		{% bootstrap_button 'Guardar'  id='btnGuardar' button_type='submit' %}

		<input type="text" 
			placeholder="Tags y Usuarios" 
			onkeyup="showTagButtons(this.value, '#botonesParaTags', '#id_texto')"
		>

		<a class="btn btn-primary" href="https://es.piliapp.com/symbol/#recents" target="_blank" role="button">
			<span class="fa fa-smile-o"><span class="sr-only">emojis</span></span>
		</a>

		<a class="btn btn-outline-success ayuda" href="https://github.com/adam-p/markdown-here/wiki/Markdown-Cheatsheet" target="_blank" role="button">
			<span class="fa fa-question-circle"><span class="sr-only">ayuda markdown</span></span>
		</a>

	</form>
	<div id="botonesParaTags"></div>
{% endblock %}

{% block extra_js%}
<script>
		// este script manda un mensaje de alerta 
		// si estas escribiendo un texto y cerras la ventana sin guardarlo

		const btnGuardar = document.getElementById('btnGuardar');
		const elTexto = document.getElementById('id_texto'); //A: me guardo el textArea
		let ultimoTextoGuardado = elTexto.value;//A: me guardo el texto que se cargo al incio

		btnGuardar.addEventListener('click',function() {//A: apreto guardar texto
			ultimoTextoGuardado = elTexto.value; //A: actualizo el texto por si el usuario lo modifico
		});
		
		window.addEventListener('beforeunload', function (e) {//U: captura el evento 'cerrar la ventana'
			if(elTexto.value != ultimoTextoGuardado){ 
				//A: se modifico el texto y el usuario no le dio guardar
				e.preventDefault(); //U: evito que se cierre la ventana
				e.returnValue = 'Â¿Desea salir y perder los cambios?';	
			}
		});

	</script>
{% endblock extra_js%}
